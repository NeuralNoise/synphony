// Generated by CoffeeScript 1.3.3
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define(['backbone', 'view/common/layout', 'view/common/menu', 'view/common/collection'], function(Backbone, Layout, MenuView, CollectionView) {
    var DesignerRouter;
    return DesignerRouter = (function(_super) {
      var prefix;

      __extends(DesignerRouter, _super);

      prefix = "designer";

      DesignerRouter.prototype.routes = {
        "designer/:project": "home"
      };

      DesignerRouter.prototype.menu = function() {
        return {};
      };

      function DesignerRouter(options) {
        DesignerRouter.__super__.constructor.call(this, options);
        this.store = options.store;
        this.layout = options.layout;
        this.project = "";
      }

      DesignerRouter.prototype.home = function(project) {
        var _this = this;
        return this.showContent(project, "home", function() {
          return new TeachingOrderView({
            store: _this.store
          });
        });
      };

      DesignerRouter.prototype.redirect = function(project, page) {
        return this.navigate("" + prefix + "/" + project + "/" + page, {
          trigger: true,
          replace: true
        });
      };

      DesignerRouter.prototype.loadProject = function(project, done) {
        if (this.project !== project) {
          this.project = project;
          this.store.setProject(project);
          return this.store.fetch({
            success: done
          });
        } else {
          return done();
        }
      };

      DesignerRouter.prototype.setupDefaultViews = function() {
        var _this = this;
        this.layout.menu.render("" + prefix + "/menu/" + this.project, function() {
          return new MenuView({
            model: {
              menu: _this.menu()
            }
          });
        });
        return this.layout.sidebar.render("designer/sidebar", function() {
          return new HiderView({
            selector: "#side-panel, #side-panel-toggle"
          });
        });
      };

      DesignerRouter.prototype.showContent = function(project, name, viewBuilder) {
        var contentName,
          _this = this;
        contentName = "" + prefix + "/" + this.project + "/" + name;
        console.log("Showing " + contentName);
        return this.loadProject(project, function() {
          _this.setupDefaultViews();
          return _this.layout.content.render(contentName, viewBuilder);
        });
      };

      return DesignerRouter;

    })(Backbone.Router);
  });

}).call(this);
