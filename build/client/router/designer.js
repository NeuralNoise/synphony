// Generated by CoffeeScript 1.3.3
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define(['backbone', 'view/common/layout', 'view/common/menu', 'view/common/hider', 'view/common/collection', 'view/designer/exporter', 'interactor/tangerine_exporter'], function(Backbone, Layout, MenuView, HiderView, CollectionView, ExporterView, TangerineExporter) {
    var DesignerRouter;
    return DesignerRouter = (function(_super) {
      var prefix;

      __extends(DesignerRouter, _super);

      prefix = "designer";

      DesignerRouter.prototype.routes = {
        "designer/:project": "home",
        "designer/:project/export": "export"
      };

      DesignerRouter.prototype.menu = function() {
        return {};
      };

      function DesignerRouter(options) {
        DesignerRouter.__super__.constructor.call(this, options);
        this.projectManager = options.projectManager;
        this.layout = options.layout;
        this.project = "";
      }

      DesignerRouter.prototype.home = function(project) {
        var _this = this;
        return this.showContent(project, "home", function() {
          return new TeachingOrderView({
            projectManager: _this.projectManager
          });
        });
      };

      DesignerRouter.prototype["export"] = function(project) {
        var _this = this;
        return this.showContent(project, "export", function() {
          var exporter;
          exporter = new TangerineExporter({
            graphemesPerLesson: 3,
            wordsPerLesson: 20,
            curriculumId: "curriculum-example-tok_pisin",
            sequence: _this.projectManager.getSequences().first(),
            projectManager: _this.projectManager
          });
          return new ExporterView({
            interactor: exporter
          });
        });
      };

      DesignerRouter.prototype.redirect = function(project, page) {
        return this.navigate("" + prefix + "/" + project + "/" + page, {
          trigger: true,
          replace: true
        });
      };

      DesignerRouter.prototype.loadProject = function(project, done) {
        if (this.project !== project) {
          this.project = project;
          this.projectManager.setProject(project);
          return this.projectManager.load(done);
        } else {
          return done();
        }
      };

      DesignerRouter.prototype.setupDefaultViews = function() {
        var _this = this;
        this.layout.menu.render("" + prefix + "/menu/" + this.project, function() {
          return new MenuView({
            model: {
              menu: _this.menu()
            }
          });
        });
        return this.layout.sidebar.render("designer/sidebar", function() {
          return new HiderView({
            selector: "#side-panel, #side-panel-toggle"
          });
        });
      };

      DesignerRouter.prototype.showContent = function(project, name, viewBuilder) {
        var contentName,
          _this = this;
        contentName = "" + prefix + "/" + this.project + "/" + name;
        console.log("Showing " + contentName);
        return this.loadProject(project, function() {
          _this.setupDefaultViews();
          return _this.layout.content.render(contentName, viewBuilder);
        });
      };

      return DesignerRouter;

    })(Backbone.Router);
  });

}).call(this);
